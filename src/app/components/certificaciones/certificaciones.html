<div class="certificaciones-wrapper">
  <div class="container py-4">
    <!-- Header -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="header-card">
          <div class="header-content">
            <h2 class="header-title">
              <i class="bi bi-people-fill me-2"></i>
              CONSULTAR CERTIFICACIONES DE EMPLEADO
            </h2>
            <div class="company-logo">
              <span class="logo-text">GLOBAL SAFETY SYSTEM</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Formulario de Búsqueda -->
    <form [formGroup]="busquedaForm" class="search-form">
      <div class="row mb-4">
        <div class="col-12">
          <div class="search-card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-search me-2"></i>
                Buscar Empleado
              </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-3">
                  <label class="form-label required">No. Empleado</label>
                  <input 
                    type="text" 
                    class="form-control"
                    formControlName="numeroEmpleado"
                    placeholder="Ej. 1234"
                    maxlength="4"
                    (input)="onNumeroEmpleadoInput($event)"
                  >
                  <div class="invalid-feedback" 
                       [style.display]="busquedaForm.get('numeroEmpleado')?.invalid && busquedaForm.get('numeroEmpleado')?.touched ? 'block' : 'none'">
                    Ingrese un número de empleado válido (4 dígitos)
                  </div>
                </div>
                
                <div class="col-md-9">
                  <label class="form-label">Nombre</label>
                  <input 
                    type="text" 
                    class="form-control auto-filled"
                    formControlName="nombre"
                    readonly
                    placeholder="El nombre se llenará automáticamente"
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>

    <!-- Estadísticas -->
    @if (numeroEmpleadoValido && tieneCertificaciones) {
      <div class="row mb-4">
        <div class="col-12">
          <div class="stats-card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-graph-up me-2"></i>
                Resumen de Certificaciones
              </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-6 col-md-2">
                  <div class="stat-item">
                    <div class="stat-number">{{ estadisticas().total }}</div>
                    <div class="stat-label">Total</div>
                  </div>
                </div>
                <div class="col-6 col-md-2">
                  <div class="stat-item">
                    <div class="stat-number text-success">{{ estadisticas().porcentaje100 }}</div>
                    <div class="stat-label">100%</div>
                  </div>
                </div>
                <div class="col-6 col-md-2">
                  <div class="stat-item">
                    <div class="stat-number text-warning">{{ estadisticas().porcentaje75 }}</div>
                    <div class="stat-label">75%</div>
                  </div>
                </div>
                <div class="col-6 col-md-2">
                  <div class="stat-item">
                    <div class="stat-number text-info">{{ estadisticas().porcentaje50 }}</div>
                    <div class="stat-label">50%</div>
                  </div>
                </div>
                <div class="col-6 col-md-2">
                  <div class="stat-item">
                    <div class="stat-number text-secondary">{{ estadisticas().porcentaje25 }}</div>
                    <div class="stat-label">25%</div>
                  </div>
                </div>
                <div class="col-6 col-md-2">
                  <div class="stat-item">
                    <div class="stat-number text-primary">{{ estadisticas().promedio }}%</div>
                    <div class="stat-label">Promedio</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Filtros por Línea -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="filters-card">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <h6 class="mb-0 me-3">
                  <i class="bi bi-funnel me-2"></i>
                  Filtrar por línea:
                </h6>
                <div class="filter-buttons">
                  <button 
                    type="button"
                    class="btn btn-filter"
                    [class.active]="filtroLinea() === 'todas'"
                    (click)="filtrarPorLinea('todas')"
                  >
                    Todas ({{ estadisticas().total }})
                  </button>
                  @for (linea of lineasDisponibles(); track linea) {
                    <button 
                      type="button"
                      class="btn btn-filter"
                      [class.active]="filtroLinea() === linea"
                      (click)="filtrarPorLinea(linea)"
                    >
                      {{ linea.split(' - ')[1] }}
                      ({{ contarCertificacionesPorLinea(linea) }})
                    </button>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabla de Certificaciones -->
      <div class="row">
        <div class="col-12">
          <div class="table-card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-table me-2"></i>
                Certificaciones de {{ datosEmpleado()?.nombre }}
                @if (filtroLinea() !== 'todas') {
                  <small class="text-muted">- {{ filtroLinea() }}</small>
                }
              </h5>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead class="table-header">
                    <tr>
                      <th scope="col">Línea</th>
                      <th scope="col">Operación</th>
                      <th scope="col">Programa</th>
                      <th scope="col">Certificación</th>
                      <th scope="col">Fecha</th>
                      <th scope="col">Entrenador</th>
                      <th scope="col">Estado</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (certificacion of certificacionesFiltradas(); track certificacion.id) {
                      <tr class="table-row">
                        <td>
                          <div class="cell-content">
                            @if (certificacion.area) {
                              <span class="badge bg-light text-dark mb-1">{{ certificacion.area }}</span>
                            }
                            <strong>{{ (certificacion.linea || '').split(' - ')[1] || certificacion.linea || '—' }}</strong>
                            <small class="text-muted d-block">{{ (certificacion.linea || '').split(' - ')[0] }}</small>
                          </div>
                        </td>
                        <td>
                          <div class="cell-content">
                            {{ certificacion.operacion.split(' - ')[1] }}
                            <small class="text-muted d-block">{{ certificacion.operacion.split(' - ')[0] }}</small>
                          </div>
                        </td>
                        <td>
                          <div class="cell-content">
                            {{ certificacion.programa.split(' - ')[1] }}
                            <small class="text-muted d-block">{{ certificacion.programa.split(' - ')[0] }}</small>
                          </div>
                        </td>
                        <td>
                          <span class="badge certification-badge" [class]="obtenerClasePorcentaje(certificacion.porcentajeCertificacion)">
                            {{ certificacion.porcentajeCertificacion }}%
                          </span>
                        </td>
                        <td>
                          <div class="cell-content">
                            {{ formatearFecha(certificacion.fechaCertificacion) }}
                          </div>
                        </td>
                        <td>
                          <div class="cell-content">
                            {{ certificacion.entrenador || '—' }}
                          </div>
                        </td>
                        <td>
                          <span class="badge badge-success">
                            {{ certificacion.estado }}
                          </span>
                        </td>
                      </tr>
                    } @empty {
                      <tr>
                        <td colspan="8" class="text-center py-4 text-muted">
                          <i class="bi bi-inbox me-2"></i>
                          No se encontraron certificaciones para este filtro
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    }

    <!-- Estado sin empleado -->
    @if (!numeroEmpleadoValido) {
      <div class="row">
        <div class="col-12">
          <div class="empty-state">
            <div class="empty-icon">
              <i class="bi bi-person-plus"></i>
            </div>
            <h4>Buscar Certificaciones</h4>
            <p class="text-muted">
              Ingrese un número de empleado válido para consultar sus certificaciones.
            </p>
          </div>
        </div>
      </div>
    }

    <!-- Estado sin certificaciones -->
    @if (numeroEmpleadoValido && !tieneCertificaciones) {
      <div class="row">
        <div class="col-12">
          <div class="empty-state">
            <div class="empty-icon">
              <i class="bi bi-clipboard-x"></i>
            </div>
            <h4>Sin Certificaciones</h4>
            <p class="text-muted">
              El empleado {{ datosEmpleado()?.nombre }} no tiene certificaciones registradas.
            </p>
          </div>
        </div>
      </div>
    }

  </div>
</div>
